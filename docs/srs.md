System Requirements Specification (SRS)

–ü—Ä–æ–µ–∫—Ç: Telegram‚Äë–±–æ—Ç ¬´–ö–∞—Ä–º–∞–Ω–Ω—ã–π –∞–≥—Ä–æ–Ω–æ–º¬ª (MVP)

–í–µ—Ä—Å–∏—è: 1.15¬†‚Äî 21‚ÄØ–Ω–æ—è–±—Ä—è‚ÄØ2025‚ÄØ–≥. (v1.14¬†‚Üí¬†v1.15: –≥–µ–æ –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç/–∫–∞—Ä—Ç–∞, rate-limit –≥–µ–æ–∫–æ–¥–µ—Ä–∞)

1 ¬∑ Scope

–°–∏—Å—Ç–µ–º–∞ ¬´–ö–∞—Ä–º–∞–Ω–Ω—ã–π –∞–≥—Ä–æ–Ω–æ–º¬ª:

–ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ª–∏—Å—Ç—å–µ–≤ ‚â§‚ÄØ2‚ÄØ–ú–ë (JPEG).

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å—ä—ë–º–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ ¬´–ö–∞–∫ —Å—Ñ–æ—Ç–∫–∞—Ç—å¬ª (–æ–±—â–∏–π –≤–∏–¥, –ª–∏—Å—Ç –ª–∏—Ü–µ–≤–∞—è, –ª–∏—Å—Ç –∏–∑–Ω–∞–Ω–∫–∞, –ø–ª–æ–¥/—Ü–≤–µ—Ç–æ–∫ –∏–ª–∏ –∫–æ—Ä–µ–Ω—å –ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏).

–°–æ–±–∏—Ä–∞–µ—Ç –º–µ–¥–∏–∞–≥—Ä—É–ø–ø—É 3‚Äì8 —Ñ–æ—Ç–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞: –æ–±—â–∏–π –≤–∏–¥ + –ª–∏—Å—Ç (–ª–∏—Ü–µ–≤–∞—è) + –ª–∏—Å—Ç (–∏–∑–Ω–∞–Ω–∫–∞); –ø–ª–æ–¥/—Ü–≤–µ—Ç–æ–∫ –∏ –∫–æ—Ä–µ–Ω—å –æ—Å—Ç–∞—é—Ç—Å—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–µ–∫–ª–∏—Å—Ç –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–æ—Å–ª–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ–æ—Ç–æ –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–∞–¥—Ä—ã. –ü–æ–¥–±–æ—Ä–∫–∞ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ —Ç–∞–π–º–∞—É—Ç—É 30‚ÄØ–º–∏–Ω.

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JPEG –≤ GPT‚ÄëVision; –ø–æ–ª—É—á–∞–µ—Ç –¥–∏–∞–≥–Ω–æ–∑ {crop, disease, confidence, reasoning, treatment_plan, next_steps}.

–§–æ—Ä–º–∏—Ä—É–µ—Ç –ø–ª–∞–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º—ã –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã –†–§ (PHI), –≤–µ–¥—ë—Ç –¥–Ω–µ–≤–Ω–∏–∫ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ–≥–æ–¥—É/—Ä–µ–≥–∏–æ–Ω.

–†–∞–∑–ª–∏—á–∞–µ—Ç Free –∏ Pro: Free ‚Äî –¥–æ 5 —Ñ–æ—Ç–æ –≤ –º–µ—Å—è—Ü, –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –æ–¥–∏–Ω–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏; Pro ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã (–±–æ–ª—å—à–µ —Ñ–æ—Ç–æ), –±–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å, –∫—É—Ä—Å—ã 1‚Äì3 —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–Ω–æ—Å–æ–º –ø–æ –ø–æ–≥–æ–¥–µ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏, –µ—Å–ª–∏ –±–∞–∑–æ–≤—ã–π –∫—É—Ä—Å –Ω–µ –ø–æ–º–æ–≥.

–°–≤–µ—Ä—è–µ—Ç –¥–∏–∞–≥–Ω–æ–∑ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –ú–∏–Ω—Å–µ–ª—å—Ö–æ–∑–∞ –†–§.

–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ¬†‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–ø–∞—Ä–∞—Ç, –¥–æ–∑—É, PHI + ROI‚Äë–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (—ç–∫–æ–Ω–æ–º–∏—è ‚ÇΩ/–≥–∞).

–ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ¬†‚Äî –±–µ–π–¥–∂ ¬´–ë–µ—Ç–∞¬†‚Äî¬†–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É –∞–≥—Ä–æ–Ω–æ–º–∞¬ª –∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É; –Ω–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è –±–ª–æ–∫–æ–º ¬´–ü–µ—Ä–µ—Å—ä—ë–º–∫–∞ / —É—Ç–æ—á–Ω–∏—Ç—å –∫—É–ª—å—Ç—É—Ä—É¬ª.

–ü—Ä–æ–¥–∞—ë—Ç Pro‚ÄëMonth (349‚ÄØ‚ÇΩ/–º–µ—Å) –∏ Pro‚ÄëYear (3‚ÄØ390‚ÄØ‚ÇΩ/–≥–æ–¥) —á–µ—Ä–µ–∑ Bot¬†Payments¬†‚Üí¬†SBP (–¢–∏–Ω—å–∫–æ—Ñ—Ñ). –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Lifetime (–µ–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–µ—Å—Å—Ä–æ—á–Ω–∞—è –ø–æ–∫—É–ø–∫–∞), –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –∫–∞–Ω–∞–ª–µ –æ–ø–ª–∞—Ç—ã.

–ê–≤—Ç–æ–ø–ª–∞—Ç—ë–∂ SBP ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è (opt‚Äëin); –±–æ—Ç —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∑–∞¬†3¬†–¥–Ω—è –¥–æ —Å–ø–∏—Å–∞–Ω–∏—è. –û—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ /cancel_autopay.

–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 402¬†PAYWALL ‚Üí –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã.

–í–µ–¥—ë—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–Ω–∏–º–∫–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—É—é –ø–æ /history.

ML‚Äë–¥–∞—Ç–∞—Å–µ—Ç: —Ñ–æ—Ç–æ —Å—Ç–∞—Ä—à–µ¬†90¬†–¥–Ω–µ–π –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–π –±–∞–∫–µ—Ç ml-dataset —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–≥–ª–∞—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–•—Ä–∞–Ω–∏—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ä–µ–∫—Ç–∞ (lat/lon –≤ objects.meta) —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∏–∞–ø–∞–∑–æ–Ω–∞; –∫–æ–º–∞–Ω–¥–∞ /location –∏ –∫–Ω–æ–ø–∫–∏ ¬´–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã¬ª –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—Ä—É—á–Ω—É—é —É–∫–∞–∑–∞—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é (—Ç–æ—á–∫–∞ –∏–ª–∏ –∞–¥—Ä–µ—Å). –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∞–≤—Ç–æ–ø–ª–∞–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∏–∑ env –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å; –≤–æ—Ä–∫–µ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (manual/geo_auto/default) –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ–ª–∏ –¥–µ—Ñ–æ–ª—Ç–æ–≤. –ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –±–æ—Ç —è–≤–Ω–æ –ø–∏—à–µ—Ç, —á—Ç–æ –∂–¥—ë—Ç —Ç–æ—á–∫—É/–∞–¥—Ä–µ—Å –Ω–µ –¥–æ–ª—å—à–µ 2‚ÄØ–º–∏–Ω—É—Ç –∏ –¥–∞—ë—Ç CTA ¬´–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å¬ª.

–ü—Ä–∏ –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç–µ –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ¬´–ù–∞—à–ª–∏ —É—á–∞—Å—Ç–æ–∫ –≤–æ–∑–ª–µ ‚Ä¶?¬ª —Å –∫–Ω–æ–ø–∫–æ–π –∫–∞—Ä—Ç—ã (OSM), —É—á–∏—Ç—ã–≤–∞—è rate-limit –≥–µ–æ–∫–æ–¥–µ—Ä–∞, TTL 12‚ÄØ—á –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –∑–∞—â–∏—Ç—É –æ—Ç —Å–ø–∞–º–∞ (–ø–æ–≤—Ç–æ—Ä –Ω–µ —á–∞—â–µ 30‚ÄØ–º–∏–Ω). Geo-–∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è.

Out-of-scope (MVP): –Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, on-device CV, –∫–∞—Ä—Ç–∞ –ø–æ–ª–µ–π, white-label SDK.

2 ¬∑ Glossary

Term

Definition

GPT‚ÄëVision

API OpenAI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON‚Äë–¥–∏–∞–≥–Ω–æ–∑.

Protocol

–ó–∞–ø–∏—Å—å: crop, disease, product, dosage_value, dosage_unit, phi, registry_date.

Pro

–ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ –∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ (—Ç–æ—á–Ω–µ–µ –º–æ–¥–µ–ª—å, –∫—É—Ä—Å—ã 1‚Äì3 —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–Ω–æ—Å–æ–º), 349‚ÄØ‚ÇΩ/–º–µ—Å –∏–ª–∏¬†3‚ÄØ390‚ÄØ‚ÇΩ/–≥–æ–¥.

PHI

Pre‚ÄëHarvest¬†Interval‚ÄØ‚Äî‚ÄØ—Å—Ä–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è –¥–æ¬†—Å–±–æ—Ä–∞ —É—Ä–æ–∂–∞—è, –¥–Ω–µ–π.

ROI

(expected_loss‚ÇΩ¬†‚Äì¬†cost_treatment‚ÇΩ)¬†/¬†ha.

Autopay SBP

–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Å–ø–∏—Å–∞–Ω–∏–π –ø–æ¬†–°–ë–ü —Å –ø—Ä–∏–≤—è–∑–∫–æ–π —Å—á—ë—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

3 ¬∑ Functional Requirements

ID

Description

Priority

FR‚ÄëT‚Äë01

–ü—Ä–∏—ë–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚â§‚ÄØ2‚ÄØ–ú–ë

High

FR‚ÄëT‚Äë02

POST¬†/v1/ai/diagnose¬†‚Üí –¥–∏–∞–≥–Ω–æ–∑

High

FR‚ÄëT‚Äë03

–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–∏–∞–≥–Ω–æ–∑–∞ + ROI

High

FR‚ÄëT‚Äë04

–ö–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ—Ç–æ–∫–æ–ª¬ª¬†/ –±–µ–π–¥–∂ ¬´–ë–µ—Ç–∞¬ª

High

FR‚ÄëT‚Äë05

Paywall + –ø–æ–∫—É–ø–∫–∞ Pro —á–µ—Ä–µ–∑ Bot¬†Payments (SBP¬†–¢–∏–Ω—å–∫–æ—Ñ—Ñ); –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ Lifetime (–±–µ—Å—Å—Ä–æ—á–Ω–∞—è –ø–æ–∫—É–ø–∫–∞), –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º

High

FR‚ÄëT‚Äë06

–õ–∏–º–∏—Ç 5¬†—Ñ–æ—Ç–æ/–º–µ—Å –¥–ª—è Free (GET¬†/v1/limits)

High

FR‚ÄëT‚Äë07

–ò—Å—Ç–æ—Ä–∏—è —Å–Ω–∏–º–∫–æ–≤ /history (cursor‚Äëpagination)

High

FR‚ÄëT‚Äë08

–ë–ª–æ–∫ ¬´–ü–µ—Ä–µ—Å—ä—ë–º–∫–∞ / —É—Ç–æ—á–Ω–∏—Ç—å –∫—É–ª—å—Ç—É—Ä—É¬ª (—Å–æ–≤–µ—Ç—ã, CTA ¬´–ü–µ—Ä–µ—Å–Ω—è—Ç—å —Ñ–æ—Ç–æ¬ª, —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É)

Medium

FR‚ÄëT‚Äë09

Webhook –ø–∞—Ä—Ç–Ω—ë—Ä–∞ /v1/partner/orders

Medium

FR‚ÄëT‚Äë10

ROI‚Äë–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: yield_loss%, price‚ÇΩ, cost‚ÇΩ

Medium

FR‚ÄëT‚Äë11

–û–ø—Ü–∏—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è Pro (/autopay/enable, /autopay/disable) ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º —Å–æ–≥–ª–∞—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (opt‚Äëin) + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ 3 –¥–Ω—è –¥–æ —Å–ø–∏—Å–∞–Ω–∏—è

Medium

FR‚ÄëT‚Äë12

–≠–∫—Å–ø–æ—Ä—Ç / —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (/v1/users/{id}/export)

Medium

FR‚ÄëT‚Äë13

–ü–ª–∞–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º—ã –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã –†–§ (—É—á—ë—Ç PHI –∏ —Ä–µ–≥–∏–æ–Ω–∞)

High

FR‚ÄëT‚Äë14

–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è Free/Pro: Free ‚Äî –¥–æ 5 —Ñ–æ—Ç–æ/–º–µ—Å, –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å, –æ–¥–∏–Ω–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏; Pro ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã, –±–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å, –∫—É—Ä—Å—ã 1‚Äì3 —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–Ω–æ—Å–æ–º –ø–æ –ø–æ–≥–æ–¥–µ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º –ø–ª–∞–Ω–æ–º –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ –±–∞–∑–æ–≤–æ–≥–æ –∫—É—Ä—Å–∞

High

FR‚ÄëT‚Äë15

–ü–æ–¥—Å–∫–∞–∑–∫–∏ ¬´–ö–∞–∫ —Å—Ñ–æ—Ç–∫–∞—Ç—å¬ª (4 –∫–∞—Ä—Ç–æ—á–∫–∏: –æ–±—â–∏–π –≤–∏–¥, –ª–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –ª–∏—Å—Ç–∞, –∏–∑–Ω–∞–Ω–∫–∞, –ø–ª–æ–¥/—Ü–≤–µ—Ç–æ–∫/–∫–æ—Ä–µ–Ω—å), –∫–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ /new –∏ –º–∞—Å—Ç–µ—Ä–µ –∑–∞–≥—Ä—É–∑–∫–∏, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –∑–∞ —Å–µ—Å—Å–∏—é

High

FR‚ÄëT‚Äë16

–ú—É–ª—å—Ç–∏—Ñ–æ—Ç–æ: –±–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º–µ–¥–∏–∞–≥—Ä—É–ø–ø—É –∏–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ, —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º 3 –∫–∞–¥—Ä–∞ (–æ–±—â–∏–π + –ª–∏—Ü–µ–≤–∞—è + –∏–∑–Ω–∞–Ω–∫–∞ –ª–∏—Å—Ç–∞), –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–ª–æ–¥/—Ü–≤–µ—Ç–æ–∫ –∏ –∫–æ—Ä–µ–Ω—å; –ª–∏–º–∏—Ç 8 —Ñ–æ—Ç–æ; —á–µ–∫–ª–∏—Å—Ç –∏ –∫–Ω–æ–ø–∫–∏ ¬´–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ¬ª / ¬´–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å¬ª / ¬´–ì–æ—Ç–æ–≤–æ ‚Äî –∞–Ω–∞–ª–∏–∑¬ª

High

FR‚ÄëT‚Äë17

–£ –æ–±—ä–µ–∫—Ç–æ–≤ –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lat/lon –≤ meta) —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∏–∞–ø–∞–∑–æ–Ω–∞; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å –∏—Ö —á–µ—Ä–µ–∑ /location –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ ¬´–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã¬ª. –°–µ—Å—Å–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∞–¥—Ä–µ—Å–∞/–≥–µ–æ—Ç–æ—á–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç, –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ.

High

FR‚ÄëT‚Äë18

–ê–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç –ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É —Å –∫–∞—Ä—Ç–æ–π (OSM) –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è; geocoder –∫–µ—à–∏—Ä—É–µ—Ç—Å—è, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è; –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ —á–∞—â–µ 30‚ÄØ–º–∏–Ω, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ 12‚ÄØ—á.

High

Copy / Tone requirements:

- GPT-–æ—Ç–≤–µ—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –≥–æ–ª–æ—Å–æ–º –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (¬´–î–∞–≤–∞–π¬ª, ¬´–°–æ–≤–µ—Ç—É—é¬ª, ¬´–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ¬ª), –±–µ–∑ Markdown-–∫–æ–¥–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤.
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç CTA: ¬´–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É¬ª –∏–ª–∏ ¬´–í—ã–±—Ä–∞—Ç—å –æ–∫–Ω–æ¬ª –ø—Ä–∏ confidence ‚â• 0.6, –ª–∏–±–æ ¬´–ü–µ—Ä–µ—Å–Ω—è—Ç—å —Ñ–æ—Ç–æ¬ª –≤ –±–ª–æ–∫–µ low-confidence.

4 ¬∑ API Contracts

4.1 Endpoints

POST¬†/v1/ai/diagnose

GET¬†/v1/photos

GET¬†/v1/limits

POST¬†/v1/payments/sbp/webhook¬†‚Äî‚ÄØ–¢–∏–Ω—å–∫–æ—Ñ—Ñ

POST¬†/v1/payments/sbp/autopay/webhook¬†‚Äî‚ÄØ–¢–∏–Ω—å–∫–æ—Ñ—Ñ (—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–ø–∏—Å–∞–Ω–∏—è)

POST¬†/v1/partner/orders

4.2 Telegram-–∫–æ–º–∞–Ω–¥—ã –∏ –∫–Ω–æ–ø–∫–∏

- `/history` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Å–Ω–∏–º–∫–æ–≤ (cursor‚Äëpagination).
- `/cancel_autopay` ‚Äî –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∞ (opt‚Äëout).
- ¬´–ö–∞–∫ —Å—Ñ–æ—Ç–∫–∞—Ç—å?¬ª ‚Äî –∫–Ω–æ–ø–∫–∞ –≤ –º–∞—Å—Ç–µ—Ä–µ /new –∏ –ø—Ä–∏—ë–º–Ω–∏–∫–µ —Ñ–æ—Ç–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 4 –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫ —Ä–∞–∑ –≤ —Å–µ—Å—Å–∏—é.
- ¬´–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ¬ª / ¬´–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å¬ª / ¬´–ì–æ—Ç–æ–≤–æ ‚Äî –∞–Ω–∞–ª–∏–∑¬ª ‚Äî —ç—Ç–∞–ø —Å–±–æ—Ä–∫–∏ –º–µ–¥–∏–∞–≥—Ä—É–ø–ø—ã (–º–∏–Ω–∏–º—É–º 3 —Ñ–æ—Ç–æ).
- `/location` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ä–µ–∫—Ç–∞; –∫–Ω–æ–ø–∫–∏ ¬´üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è¬ª / ¬´‚å®Ô∏è –í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å¬ª / ¬´‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã¬ª –≤ –º–∞—Å—Ç–µ—Ä–µ –ø–ª–∞–Ω–æ–≤.
- Inline CTA: ¬´–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É¬ª, ¬´–ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ PHI¬ª, ¬´PDF‚Äë–∑–∞–º–µ—Ç–∫–∞¬ª, ¬´–°–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã¬ª, ¬´–ü–µ—Ä–µ—Å–Ω—è—Ç—å —Ñ–æ—Ç–æ¬ª.

4.3 Schemas (excerpt)

DiagnosisResponse:
  crop: string
  disease: string
  confidence: number # 0‚Äë1
  reasoning: string
  treatment_plan:
    product: string
    dosage: string
    phi: string
    safety: string?
  next_steps:
    reminder: string
    green_window: string
    cta: string
  roi:
    economy_per_ha: number
    currency: "RUB"

PaymentWebhook:
  id: string  # invoice id
  amount: int # –∫–æ–ø–µ–π–∫–∏
  status: enum {SUCCESS, FAIL, CANCEL}
  signature: string # HMAC‚ÄëSHA256

4.4 Errors

HTTP

Code

Description

400

BAD_REQUEST

–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞

402

PAYWALL

–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞¬†Pro

429

LIMIT_EXCEEDED

–ü—Ä–µ–≤—ã—à–µ–Ω–∞ –∫–≤–æ—Ç–∞

502

GPT_TIMEOUT

GPT –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –∑–∞¬†10‚ÄØ—Å

4.5 –ü–ª–∞–Ω –ø–∞–º—è—Ç–∏ –∏ –∞–≤—Ç–æ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 4.5.1 –ú–∞—à–∏–Ω–Ω—ã–π –ø–∞–∫–µ—Ç –æ—Ç–≤–µ—Ç–∞ –ò–ò

- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–∏–∞–≥–Ω–æ–∑–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç JSON-–±–ª–æ–∫ `plan_payload`.
- –ü–æ–ª—è –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è: `kind` (PLAN_NEW, PLAN_UPDATE, QNA, FAQ), `object_hint`, `diagnosis` { `crop`, `disease`, `confidence` }, `case_id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), `stages`.
- –ö–∞–∂–¥—ã–π `stage` –æ–ø–∏—Å—ã–≤–∞–µ—Ç `name`, `trigger` (¬´–¥–æ —Ü–≤–µ—Ç–µ–Ω–∏—è¬ª, ¬´–ø–æ—Å–ª–µ –¥–æ–∂–¥—è >10 –º–º¬ª, ¬´–ø—Ä–∏ —Å–∏–º–ø—Ç–æ–º–∞—Ö¬ª), `notes`, `options`.
- `options` (–¥–æ 3): `{ product_code?, product_name, ai, dose: { value, unit }, method, phi_days, notes }`.
- –¢–∏–ø `kind` —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º: PLAN_* ‚Üí —Å–æ–∑–¥–∞—ë–º/–æ–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫, QNA/FAQ ‚Üí –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—Ç –≤ —á–∞—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞.

#### 4.5.2 –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

- –î–æ–∑–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã (–ª/–≥–∞, –≥/–ª, –º–ª/10–ª), `phi_days` –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ —á–∏—Å–ª—É, –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Üí `null`.
- `product_code` –º–∞–ø–ø–∏—Ç—Å—è –Ω–∞ `product_rules` –ø–æ –∫—É–ª—å—Ç—É—Ä–µ/—Ä–µ–≥–∏–æ–Ω—É; –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Äî `needs_review` –∏ –æ–ø—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
- –ö–∞–∂–¥–∞—è –æ–ø—Ü–∏—è —Å–≤–µ—Ä—è–µ—Ç—Å—è —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Ä–µ–µ—Å—Ç—Ä–∞–º–∏ –†–§ (–î–í/–ø—Ä–µ–ø–∞—Ä–∞—Ç, –Ω–æ—Ä–º—ã, PHI); –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–∞—Ä–∫–∏—Ä—É–µ—Ç—Å—è `needs_review`.
- –≠—Ç–∞–ø—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É (–≤–µ—Å–Ω–∞ ‚Üí –¥–æ —Ü–≤–µ—Ç–µ–Ω–∏—è ‚Üí –ø–æ—Å–ª–µ –¥–æ–∂–¥—è ‚Üí –ø—Ä–∏ —Å–∏–º–ø—Ç–æ–º–∞—Ö), –≤–Ω—É—Ç—Ä–∏ —ç—Ç–∞–ø–∞ –æ–ø—Ü–∏–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –∫–∞—Ç–∞–ª–æ–≥–∞.
- –°—á–∏—Ç–∞–µ–º SHA-1 –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–≥–æ JSON. –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–∞–Ω—Ç–∏-–¥—Ä–µ–±–µ–∑–≥).

#### 4.5.3 –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∏ –≤–µ—Ä—Å–∏–∏

- **draft** ‚Äî —á–µ—Ä–Ω–æ–≤–∏–∫ –ø–æ—Å–ª–µ PLAN_NEW/PLAN_UPDATE, —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–æ –ø–æ–∫–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- **proposed** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–µ–ª —Ç–∞–±–ª–∏—Ü—É —ç—Ç–∞–ø–æ–≤ –∏ –∫–∞—Ä—Ç–æ—á–∫—É –∞–≤—Ç–æ–ø–ª–∞–Ω–∞; –¥–æ—Å—Ç—É–ø–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è ¬´–ü—Ä–∏–Ω—è—Ç—å¬ª, ¬´–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å¬ª, ¬´–ü—Ä–∏–Ω—è—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ¬ª.
- **accepted** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç –∏–ª–∏ –Ω–∞–∂–∞–ª ¬´–ü—Ä–∏–Ω—è—Ç—å –ø–ª–∞–Ω¬ª.
- **scheduled** ‚Äî —Å–æ–∑–¥–∞–Ω—ã —Å–æ–±—ã—Ç–∏—è/–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–æ–±—Ä–∞–±–æ—Ç–∫–∞, PHI, –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–≥–æ–¥—ã).
- **superseded** ‚Äî –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞—è accepted/scheduled –≤–µ—Ä—Å–∏—è —Ç–æ–≥–æ –∂–µ object_id + case_id.
- **rejected** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –∞–ø–¥–µ–π—Ç.
- –ò—Å—Ç–∏–Ω–∞ –¥–ª—è UI: –ø–æ—Å–ª–µ–¥–Ω–∏–π accepted/scheduled –ø–æ object_id + case_id. PLAN_UPDATE –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è.

#### 4.5.4 –î–∏—Ñ—Ñ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

- Draft —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å –∞–∫—Ç–∏–≤–Ω—ã–º –ø–ª–∞–Ω–æ–º: diff –ø–æ —ç—Ç–∞–ø–∞–º (–Ω–æ–≤—ã–µ, —É–¥–∞–ª—ë–Ω–Ω—ã–µ, –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏, PHI, –¥–æ–∑—ã).
- –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç —É–∂–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –≤—ã–±–æ—Ä: ¬´–ü—Ä–∏–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è¬ª (–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏—è), ¬´–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å¬ª, ¬´–ü—Ä–∏–Ω—è—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ¬ª (—Ç–æ–ª—å–∫–æ –±—É–¥—É—â–∏–µ —ç—Ç–∞–ø—ã).
- –ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∫–∏ (–æ–ø–∏—Å–∞–Ω–∏—è –±–µ–∑ —Å–º–µ–Ω—ã –¥–æ–∑/PHI/–î–í) –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏; –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (—Ä–æ—Å—Ç –¥–æ–∑—ã, PHI, —Å–º–µ–Ω–∞ –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –≤–µ—â–µ—Å—Ç–≤–∞) –≤—Å–µ–≥–¥–∞ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

#### 4.5.5 –ê–≤—Ç–æ–ø–ª–∞–Ω –∏ —Å–ª–æ—Ç—ã

- `POST /treatments/{id}/autoplan` —Å–æ–∑–¥–∞—ë—Ç `autoplan_run` –∏ —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É –≤–æ—Ä–∫–µ—Ä—É.
- –í–æ—Ä–∫–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑ 72 —á –≤–ø–µ—Ä—ë–¥ (—à–∞–≥ 30 –º–∏–Ω). –ü—Ä–∞–≤–∏–ª–∞ ‚Äî –≤ `docs/ALGORITHMS/auto_planner.md`.
- –ï—Å–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –æ–∫–æ–Ω –Ω–µ—Ç, –ø–ª–∞–Ω –ø–æ–º–µ—á–∞–µ—Ç—Å—è `awaiting_window`; –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.
- –í Pro –∫—É—Ä—Å–∞—Ö 1‚Äì3 –ø—Ä–∏ —Ñ–∞–∫—Ç–µ –¥–æ–∂–¥—è/–æ—Å–∞–¥–∫–æ–≤ –ø–æ—Å–ª–µ —ç—Ç–∞–ø–∞ –±–æ—Ç –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –Ω–∞ –±–ª–∏–∂–∞–π—à–µ–µ üü¢ –æ–∫–Ω–æ; –µ—Å–ª–∏ –∫—É—Ä—Å –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω (–Ω–æ–≤—ã–µ –æ–ø—Ü–∏–∏ –Ω–∞ —ç—Ç–∞–ø).
- –°–æ–±—ã—Ç–∏—è/–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç `plan_stage_id` –∏ `stage_option_id`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∏—Ö –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –ø—Ä–∏–Ω—è—Ç–∏—è—Ö.
- –î–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è `slot_signature = treatment_id + slot_start`; –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

5 ¬∑ Data Model (PostgreSQL)

users(
  id SERIAL PRIMARY KEY,
  tg_id BIGINT UNIQUE NOT NULL,
  pro_expires_at TIMESTAMP,
  autopay_enabled BOOLEAN DEFAULT FALSE,
  is_trial_used BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT now()
);

photos(
  id SERIAL PRIMARY KEY,
  user_id BIGINT,
  file_id TEXT,
  crop TEXT,
  disease TEXT,
  confidence NUMERIC(4,3),
  roi NUMERIC(10,2),
  ts TIMESTAMP DEFAULT now()
);

protocols(
  id SERIAL PRIMARY KEY,
  crop TEXT,
  disease TEXT,
  category TEXT,
  status TEXT,
  waiting_days INT,
  product TEXT,
  dosage_value NUMERIC(6,2),
  dosage_unit TEXT,
  phi INT,
  registry_date DATE
);

payments(
  id SERIAL PRIMARY KEY,
  user_id BIGINT,
  amount INT,
  source TEXT,              -- "SBP:Tinkoff"
  autopay BOOLEAN DEFAULT FALSE,
  autopay_binding_id TEXT,
  status TEXT,
  created_at TIMESTAMP DEFAULT now()
);

photo_usage(
  user_id BIGINT,
  month CHAR(7),            -- YYYY-MM
  used INT,
  updated_at TIMESTAMP,
  PRIMARY KEY (user_id, month)
);

–ò–Ω–¥–µ–∫—Å—ã: photos_user_ts_idx(user_id, ts DESC); —Å—á—ë—Ç—á–∏–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç CRON 5¬†0¬†1¬†*¬†* (Europe/Moscow).

6 ¬∑ Sequence Diagrams

6.1 Diagnose¬†‚Äî¬†Happy Path

User  ‚Üí Bot:  —Ñ–æ—Ç–æ (JPEG)
Bot   ‚Üí TG:   getFile
Bot   ‚Üí GPT:  diagnose
GPT   ‚Üí Bot:  JSON
Bot   ‚Üí DB:   INSERT photos (+ROI)
Bot   ‚Üí User: –¥–∏–∞–≥–Ω–æ–∑ + ROI + –∫–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ—Ç–æ–∫–æ–ª¬ª

–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π JSON –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

- `crop`, `disease`, `disease_name_ru`, `confidence`.
- `reasoning[]` ‚Äî 2‚Äì4 –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–∑ (¬´–∂—ë–ª—Ç—ã–µ –ø—è—Ç–Ω–∞¬ª, ¬´–Ω–∞–ª—ë—Ç –Ω–∞ –≤–µ—Ä—Ö–Ω–∏—Ö –ª–∏—Å—Ç—å—è—Ö¬ª).
- `treatment_plan` ‚Äî `product`, `substance`, `dosage_value`/`dosage_unit` (–∏–ª–∏ fallback `dosage`), `method`, `phi_days|phi`, `safety_note`.
- `next_steps` ‚Äî `reminder`, `green_window`, `cta`.
- `need_reshoot` –∏ `reshoot_tips[]` (–µ—Å–ª–∏ `confidence < 0.6` –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∏–∑–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞).
- `assistant_ru` –∏ `assistant_followups_ru[]` ‚Äî –≥–æ—Ç–æ–≤—ã–π –∂–∏–≤–æ–π –æ—Ç–≤–µ—Ç –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ follow-up –≤–æ–ø—Ä–æ—Å—ã.
- `need_clarify_crop` + `clarify_crop_variants[]` ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫—É–ª—å—Ç—É—Ä—ã, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ —É–≤–µ—Ä–µ–Ω–∞.
- `plan_missing_reason` ‚Äî –ø–æ—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É –ø–ª–∞–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç—ã–º –≤ —à—Ç–∞—Ç–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏).

–ë–æ—Ç —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –µ–¥–∏–Ω—ã–π RU‚Äë–æ—Ç–≤–µ—Ç —Å –±–ª–æ–∫–∞–º–∏ ¬´üì∏ –î–∏–∞–≥–Ω–æ–∑¬ª ‚Üí ¬´üß™ –ü–æ—á–µ–º—É —Ç–∞–∫¬ª ‚Üí ¬´üß¥ –ß—Ç–æ –¥–µ–ª–∞—Ç—å¬ª ‚Üí ¬´‚è∞ –ß—Ç–æ –¥–∞–ª—å—à–µ¬ª + –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ CTA‚Äë–∫–Ω–æ–ø–∫–∏ (¬´–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å¬ª, ¬´–ù–∞–ø–æ–º–Ω–∏—Ç—å PHI¬ª, ¬´PDF‚Äë–∑–∞–º–µ—Ç–∫–∞¬ª, ¬´–°–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã¬ª). –ü—Ä–∏ —Å–æ–º–Ω–µ–Ω–∏—è—Ö –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç crop_hint (–≤–∏–Ω–æ–≥—Ä–∞–¥/—Ç–æ–º–∞—Ç/–∫–æ–º–Ω–∞—Ç–Ω–æ–µ) –∏ –ø–µ—Ä–µ—Å—ä—ë–º–∫—É.

6.2 Purchase Pro (one‚Äëtime)

User ‚Üí Bot:  –Ω–∞–∂–∞–ª ¬´–ö—É–ø–∏—Ç—å Pro¬ª
Bot  ‚Üí Tinkoff:  CreateInvoice (SBP‚ÄëQR)
Bot  ‚Üí User:     QR‚Äë–∫–æ–¥
Tinkoff ‚Üí Bot:   POST /payments/sbp/webhook (SUCCESS)
Bot  ‚Üí DB:       UPDATE users.pro_expires_at
Bot  ‚Üí User:     ¬´Pro –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–æ ‚Ä¶¬ª

6.3 Autopay Renewal

Cron ‚Üí Bot:  –ø—Ä–æ–≤–µ—Ä–∫–∞ expiring‚Äësoon
Bot  ‚Üí User: –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (3¬†–¥–Ω—è)
T‚Äë0 Bot   ‚Üí Tinkoff: CreateAutopayCharge
Tinkoff ‚Üí Bot: POST /payments/sbp/autopay/webhook (SUCCESS|FAIL)
Bot ‚Üí User:  ¬´–ü—Ä–æ–¥–ª–µ–Ω–æ / –û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞¬ª
Autopay –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ user –¥–∞–ª —è–≤–Ω—ã–π opt‚Äëin (autopay_enabled=true); –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.

6.4 Limit Reached

API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 402¬†PAYWALL¬†‚Üí –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã.

7 ¬∑ Edge¬†Cases

Code

Behavior

NO_LEAF

confidence¬†<¬†0.2¬†‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ª–∏—Å—Ç‚Ä¶¬ª

BLUR

variance¬†<¬†50¬†‚Üí —Ç–æ¬†–∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

GPT_TIMEOUT

GPT¬†>¬†10‚ÄØ—Å¬†‚Üí —Ñ–æ—Ç–æ pending, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

LIMIT_EXCEEDED

Free‚Äëuser¬†>¬†5¬†—Ñ–æ—Ç–æ¬†‚Üí 402¬†PAYWALL

PAYMENT_FAIL

Webhook¬†status=FAIL¬†‚Üí grace 3¬†–¥–Ω—è, –ø–æ–≤—Ç–æ—Ä –æ–ø–ª–∞—Ç—ã

8 ¬∑ Non‚ÄëFunctional Requirements

Metric

Target

diag_latency_p95

‚â§¬†8‚ÄØ—Å

Availability

‚â•‚ÄØ99.5‚ÄØ%¬†/¬†month

GPT¬†OPEX

‚â§‚ÄØ0.50‚ÄØ‚ÇΩ¬†/¬†—Ñ–æ—Ç–æ

Billing_fairness

–ù–µ—Ç –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–π –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è; —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚â•‚ÄØ3¬†–¥–Ω—è –¥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –¥–æ —Å–ø–∏—Å–∞–Ω–∏—è

Expert¬†SLA

90‚ÄØ% –æ—Ç–≤–µ—Ç–æ–≤ ‚â§‚ÄØ2‚ÄØ—á

9 ¬∑ Observability

Prometheus¬†–º–µ—Ç—Ä–∏–∫–∏:

diag_latency_seconds

diag_requests_total

roi_calc_seconds

gpt_timeout_total

payment_fail_total

quota_reject_total

autopay_charge_seconds

Alerts:

gpt_timeout_total{5m}¬†>¬†5‚ÄØ%

rate(error)¬†>¬†2‚ÄØ%

queue_pending¬†>¬†100

autopay_fail_total{1h}¬†>¬†5

10 ¬∑ Security

SBP Webhook: HMAC‚ÄëSHA256 (X-Sign¬†+¬†body.signature), —Å–µ–∫—Ä–µ—Ç—ã –≤ Vault, rotation¬†90‚ÄØ–¥–Ω.

GPT Key: Vault, rotation¬†30‚ÄØ–¥–Ω.

Photos: S3 lifecycle delete 90‚ÄØ–¥–Ω; –ø—Ä–∏ users.opt_in=true —ç–∫—Å–ø–æ—Ä—Ç –≤ ml-dataset (anonymised) –Ω–∞¬†2¬†–≥–æ–¥–∞.

–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –§–ó‚Äë152/GDPR: /v1/users/{id}/export, /v1/users/{id}/delete¬†‚Äî SLA 30‚ÄØ–¥–Ω.

11 ¬∑ DB Migration Policy

Alembic¬†(semver). Rollback SLA¬†15‚ÄØ–º–∏–Ω.

12 ¬∑ Scalability

One¬†worker ‚âà¬†30¬†msg/s; HPA –ø—Ä–∏¬†CPU¬†>¬†75‚ÄØ%. GPT¬†concurrency¬†10/worker; Redis¬†queue, fallback¬†PG.

13 ¬∑ Logs¬†&¬†Monitoring

Grafana‚ÄëLoki¬†JSON‚Äë–ª–æ–≥–∏: user_id, diag_id, latency, roi, error_code, autopay. Retention¬†30‚ÄØ–¥–Ω.

14 ¬∑ UX¬†‚Äì Error Messages

Code

Message

NO_LEAF

¬´–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ª–∏—Å—Ç. –°–Ω–∏–º–∏—Ç–µ –∫—Ä—É–ø–Ω–µ–µ –∏¬†–ø—Ä–∏ –¥–Ω–µ–≤–Ω–æ–º —Å–≤–µ—Ç–µ.¬ª

LIMIT_EXCEEDED

¬´–õ–∏–º–∏—Ç¬†5¬†–±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ñ–æ—Ç–æ –∏—Å—á–µ—Ä–ø–∞–Ω. Pro¬†‚Äî¬†349‚ÄØ‚ÇΩ/–º–µ—Å –±–µ–∑¬†–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.¬ª

GPT_TIMEOUT

¬´–°–µ—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞, —Ñ–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ¬†‚Äî –ø—Ä–∏—à–ª—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∑–∂–µ.¬ª

PAYMENT_FAIL

¬´–ü–ª–∞—Ç—ë–∂ –Ω–µ¬†–ø—Ä–æ—à—ë–ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç–µ –∞–≤—Ç–æ–ø–ª–∞—Ç—ë–∂.¬ª

15 ¬∑ Open Questions (–∑–∞–∫—Ä—ã—Ç–æ –≤¬†v1.7)

–í–æ–ø—Ä–æ—Å

–û—Ç–≤–µ—Ç

SBP‚Äë–ø—Ä–æ–≤–∞–π–¥–µ—Ä

–¢–∏–Ω—å–∫–æ—Ñ—Ñ –æ—Å–Ω–æ–≤–Ω–æ–π, fallback¬†‚Äî¬†–ÆKassa (–°–±–µ—Ä)

–ü—Ä–æ–¥–ª–µ–Ω–∏–µ¬†Pro

–ê–≤—Ç–æ–ø–ª–∞—Ç—ë–∂ SBP (opt‚Äëin), —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ¬†‚àí3‚ÄØ–¥–Ω—è

ML‚Äë–¥–∞—Ç–∞—Å–µ—Ç

–î–∞, –ø—Ä–∏ Opt‚ÄëIn –∏ –¥–≤–æ–π–Ω–æ–π –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–∏

16 ¬∑ Approval

Role

Name

Status

CTO

‚Äî

‚òê

ML¬†Lead

‚Äî

‚òê

FinOps

‚Äî

‚òê

Legal

‚Äî

‚òê

–î–æ–∫—É–º–µ–Ω—Ç docs/srs.md (v1.12) –∑–∞–º–µ–Ω—è–µ—Ç –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ ‚â§‚ÄØ1.11.
