openapi: 3.0.3

info:
  title: Agronom Bot Internal API
  version: "1.10.0"
  description: |
    Telegram-бот «Карманный агроном» — API v1.10.0.
    Fixes: +signature, +UNAUTHORIZED, +monthly limits, +X-API-Ver usage, +multipart required, clarified dosage units, +X-User-ID header, +ask_expert endpoint, +protocol fields category/status/waiting_days.
  contact:
    name: Ivan Gromov
    url: https://github.com/agronom-bot
    email: i.gromov@agrostore.ru

servers:
  - url: https://api.agronom.local
    description: Production
  - url: https://staging.agronom.local
    description: Staging

security:
  - ApiKeyAuth: []

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    HmacAuth:
      type: apiKey
      in: header
      name: X-Sign

  parameters:
    ApiVersionHeader:
      name: X-API-Ver
      in: header
      required: true
      schema:
        type: string
        enum: [v1]
    UserIdHeader:
      name: X-User-ID
      in: header
      required: true
      schema:
        type: integer

  schemas:
    DiagnoseRequestMultipart:
      type: object
      required: [image]
      properties:
        image:
          type: string
          format: binary
        prompt_id:
          type: string
          enum: [v1]
        crop_hint:
          type: string
          description: "Необязательная подсказка культуры (например, 'томат')."

    DiagnoseRequestBase64:
      type: object
      required: [image_base64, prompt_id]
      properties:
        image_base64:
          type: string
          description: Base64-JPEG/PNG ≤ 2 MB
        prompt_id:
          type: string
          enum: [v1]
        crop_hint:
          type: string
          description: "Необязательная подсказка культуры (например, 'томат')."

    DiagnoseResponse:
      type: object
      required: [crop, disease, confidence, roi]
      properties:
        crop:
          type: string
          example: apple
        crop_ru:
          type: string
          example: "яблоня"
        disease:
          type: string
          example: powdery_mildew
        disease_name_ru:
          type: string
          example: "мучнистая роса"
        confidence:
          type: number
          format: float
          example: 0.87
        roi:
          type: number
          format: float
          example: 1.9
        reasoning:
          type: array
          items:
            type: string
          example:
            - "Белый налёт по прожилкам"
            - "Пятна на верхних листьях"
        treatment_plan:
          $ref: '#/components/schemas/TreatmentPlan'
        next_steps:
          $ref: '#/components/schemas/NextSteps'
        plan_missing_reason:
          type: string
          description: "Причина отсутствия плана лечения (если модель его не прислала)."
        need_reshoot:
          type: boolean
          description: "true, если модель просит переснять фото."
        reshoot_tips:
          type: array
          description: "Набор советов для пересъёмки."
          items:
            type: string
        need_clarify_crop:
            type: boolean
            description: "true, если модель хочет уточнить предполагаемую культуру."
        clarify_crop_variants:
            type: array
            items:
              type: string
            description: "Список вариантов культуры на выбор пользователя."
        assistant_ru:
          type: string
          description: "Готовый текстовый ответ на русском для пользователя."
        assistant_followups_ru:
          type: array
          items:
            type: string
          description: "Короткие ответы на типовые уточняющие вопросы."
        protocol_status:
          type: string
          example: "Бета"
        protocol:
          $ref: '#/components/schemas/ProtocolResponse'

    ProtocolResponse:
      type: object
      required: [id, product, dosage_value, dosage_unit, phi]
      properties:
        id:
          type: integer
          example: 1
        product:
          type: string
          example: Скор 250 ЭК
        dosage_value:
          type: number
          example: 2
        dosage_unit:
          type: string
          enum: [ml_10l, g_per_l]
          example: ml_10l
        phi:
          type: integer
          example: 30
        category:
          type: string
          example: main
        status:
          type: string
          example: active
        waiting_days:
          type: integer
          example: 30

    PhotoItem:
      allOf:
        - $ref: '#/components/schemas/DiagnoseResponse'
        - type: object
          required: [id, ts]
          properties:
            id:
              type: integer
              example: 42
            ts:
              type: string
              format: date-time
              example: "2025-07-20T12:34:56Z"

    TreatmentPlan:
      type: object
      properties:
        product:
          type: string
          example: "Топаз"
        substance:
          type: string
          example: "Диазенконозол (триазолы)"
        dosage_value:
          type: number
          format: float
          example: 2.5
        dosage_unit:
          type: string
          example: "мл/10л"
        dosage:
          type: string
          example: "2 мл на 10 л воды, опрыскивание по листу"
        method:
          type: string
          example: "Опрыскивание по листу"
        phi:
          type: string
          example: "30 дней"
        phi_days:
          type: integer
          example: 30
        safety:
          type: string
          example: "Перчатки, очки, не распылять при ветре"
        safety_note:
          type: string
          example: "Работай в СИЗ, ветер <5 м/с"

    NextSteps:
      type: object
      required: [reminder, green_window]
      properties:
        reminder:
          type: string
          example: "Добавь повтор обработки через 7 дней и отметь PHI."
        green_window:
          type: string
          example: "Выбери вечер без дождя и ветра >5 м/с."
        cta:
          type: string
          example: "Добавить обработку"

    PhotoHistoryItem:
      type: object
      required: [photo_id, ts, crop, disease, status, confidence, thumb_url]
      properties:
        photo_id:
          type: integer
          example: 1
        ts:
          type: string
          format: date-time
          example: "2025-07-20T12:34:56Z"
        crop:
          type: string
          example: apple
        disease:
          type: string
          example: scab
        status:
          type: string
          enum: [pending, ok, retrying, failed]
          example: ok
        confidence:
          type: number
          format: float
          example: 0.92
        thumb_url:
          type: string
          format: uri
          example: https://cdn.example/thumb1.jpg

    ListPhotosResponse:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PhotoItem'
        next_cursor:
          type: string
          nullable: true
          description: "Передайте значение в ?cursor=… для следующей страницы (формат `<id>:<unix_ts>`)"

    PaymentWebhook:
      type: object
      required: [external_id, status, paid_at, signature]
      properties:
        external_id:
          type: string
        status:
          type: string
          enum: [success, fail, cancel, bank_error]
        paid_at:
          type: string
          format: date-time
        signature:
          type: string
          description: HMAC-SHA256 of payload

    AutopayWebhook:
      type: object
      required: [autopay_charge_id, binding_id, user_id, amount, status, charged_at, signature]
      properties:
        autopay_charge_id:
          type: string
          example: CHG-1
        binding_id:
          type: string
          example: BND-1
        user_id:
          type: integer
        amount:
          type: integer
        status:
          type: string
          enum: [success, fail, cancel, bank_error]
        charged_at:
          type: string
          format: date-time
        signature:
          type: string
          description: HMAC-SHA256 of payload

    AutopayCancelRequest:
      type: object
      required: [user_id]
      properties:
        user_id:
          type: integer

    PaymentCreateRequest:
      type: object
      required: [user_id, plan]
      properties:
        user_id:
          type: integer
        plan:
          type: string
          enum: [pro]
          example: pro
        months:
          type: integer
          default: 1
        autopay:
          type: boolean
          nullable: true
          description: Enable SBP Autopay binding

    PaymentStatusResponse:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [pending, success, fail, cancel, bank_error]
        pro_expires_at:
          type: string
          format: date-time
          nullable: true

    PhotoStatusResponse:
      type: object
      required: [status, updated_at]
      properties:
        status:
          type: string
          enum: [pending, ok, retrying, failed]
        updated_at:
          type: string
          format: date-time
        crop:
          type: string
        disease:
          type: string
        protocol:
          $ref: '#/components/schemas/ProtocolResponse'

    DiagnoseQueuedResponse:
      type: object
      required: [id, status]
      properties:
        id:
          type: integer
          example: 1
        status:
          type: string
          example: pending

    ErrorResponse:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
          enum:
            [NO_LEAF, LIMIT_EXCEEDED, GPT_TIMEOUT, BAD_REQUEST, UNAUTHORIZED, UPGRADE_REQUIRED, TOO_MANY_REQUESTS, SERVICE_UNAVAILABLE, FORBIDDEN]
        message:
          type: string
    LimitReached:
      type: object
      required: [error, limit]
      properties:
        error:
          type: string
          example: limit_reached
        limit:
          type: integer
          example: 5
    PlanSessionUpsertRequest:
      type: object
      required: [token, diagnosis]
      properties:
        token:
          type: string
          example: mi0jzzh5i6ba7l
        diagnosis:
          type: object
          additionalProperties: true
          description: "Ответ diagnose API, сохранённый для мастера планов."
        current_step:
          type: string
          example: choose_object
        state:
          type: object
          additionalProperties: true
          description: "Произвольное состояние мастера (выбор объекта, триггер и т.д.)."
        recent_diagnosis_id:
          type: integer
          nullable: true
        object_id:
          type: integer
          nullable: true
        plan_id:
          type: integer
          nullable: true
        ttl_hours:
          type: integer
          nullable: true
          description: "Переопределение TTL (по умолчанию берётся из PLAN_SESSION_TTL_H)."
    PlanSessionRecord:
      type: object
      required: [id, user_id, token, created_at, updated_at, expires_at, expired, current_step, state, diagnosis]
      properties:
        id:
          type: integer
          example: 5
        user_id:
          type: integer
          example: 42
        token:
          type: string
          example: mi0jzzh5i6ba7l
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        expired:
          type: boolean
        current_step:
          type: string
          example: time_picker
        state:
          type: object
          additionalProperties: true
        diagnosis:
          type: object
          additionalProperties: true
        recent_diagnosis_id:
          type: integer
          nullable: true
        object_id:
          type: integer
          nullable: true
        plan_id:
          type: integer
          nullable: true
    PlanSessionPatchRequest:
      type: object
      properties:
        diagnosis:
          type: object
          additionalProperties: true
        current_step:
          type: string
        state:
          type: object
          additionalProperties: true
        recent_diagnosis_id:
          type: integer
          nullable: true
        object_id:
          type: integer
          nullable: true
        plan_id:
          type: integer
          nullable: true
        ttl_hours:
          type: integer
          nullable: true

paths:
  /v1/ai/diagnose:
    post:
      summary: Diagnose plant disease
      operationId: diagnosePlant
      description: |
        Upload a leaf photo and get back the predicted crop,
        disease and confidence score. Supports multipart uploads
        via `image` field or JSON body with `image_base64`.
      tags: [diagnose]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/DiagnoseRequestMultipart'
          application/json:
            schema:
              $ref: '#/components/schemas/DiagnoseRequestBase64'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiagnoseResponse'
        '202':
          description: Image queued for processing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiagnoseQueuedResponse'
        '400':
          description: Bad image / bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '413':
          description: Image too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '402':
          description: Free quota exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LimitReached'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Unexpected internal error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-rateLimit:
        ip_limit: 30
        user_limit: 120
        window: minute

  /v1/plans/sessions:
    post:
      summary: Create or refresh plan wizard session state
      operationId: upsertPlanSession
      tags: [plans]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanSessionUpsertRequest'
      responses:
        '200':
          description: Session stored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlanSessionRecord'
        '400':
          description: Invalid payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      summary: Fetch the latest or token-specific plan wizard session
      operationId: getPlanSession
      tags: [plans]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
        - name: token
          in: query
          required: false
          schema:
            type: string
            description: "Если не указан, возвращается последняя сессия пользователя."
        - name: include_expired
          in: query
          required: false
          schema:
            type: boolean
            default: false
        - name: plan_id
          in: query
          required: false
          schema:
            type: integer
            description: "Вернуть сессию, связанную с планом (взаимоисключается с token)."
      responses:
        '200':
          description: Session returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlanSessionRecord'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '410':
          description: Session expired (unless include_expired=true)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete plan wizard session(s)
      operationId: deletePlanSession
      tags: [plans]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
        - name: token
          in: query
          required: false
          schema:
            type: string
            description: "Если не указан, удаляются все сессии пользователя."
        - name: plan_id
          in: query
          required: false
          schema:
            type: integer
            description: "Удалить сессии, связанные с планом."

  /v1/plans/sessions/{session_id}:
    patch:
      summary: Update plan wizard session fields
      operationId: patchPlanSession
      tags: [plans]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
        - name: session_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanSessionPatchRequest'
      responses:
        '200':
          description: Updated session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlanSessionRecord'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/photos:
    get:
      summary: List user’s photos (history)
      operationId: listPhotos
      description: List previously uploaded photos with pagination.
      tags: [photos]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 50
        - name: cursor
          in: query
          schema:
            type: string
            description: "Отдаётся в ответе как `next_cursor` (формат: `<id>:<unix_ts>`)"
      responses:
        '200':
          description: Paginated list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListPhotosResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/photos/history:
    get:
      summary: Photo history (offset)
      operationId: listPhotosHistory
      description: Return past photos ordered by ts DESC.
      tags: [photos]
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: user_id
          in: query
          schema:
            type: integer
          description: User ID (stub)
      responses:
        '200':
          description: List of history items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PhotoHistoryItem'
              example:
                - photo_id: 1
                  ts: "2025-07-20T12:34:56Z"
                  crop: apple
                  disease: scab
                  status: ok
                  confidence: 0.92
                  thumb_url: https://cdn.example/1.jpg
                - photo_id: 2
                  ts: "2025-07-21T13:45:00Z"
                  crop: tomato
                  disease: blight
                  status: failed
                  confidence: 0.45
                  thumb_url: https://cdn.example/2.jpg

  /v1/photos/{photo_id}:
    get:
      summary: Get photo status
      description: Retrieve status and metadata of a previously uploaded photo.
      operationId: getPhotoStatus
      tags: [photos]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
        - in: path
          name: photo_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Photo details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PhotoStatusResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found

  /v1/limits:
    get:
      summary: Возвращает текущие лимиты пользователя
      operationId: getUserLimits
      description: Retrieve current monthly usage limits for the authenticated user.
      tags: [limits]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      responses:
        '200':
          description: Текущие лимиты
          content:
            application/json:
              schema:
                type: object
                required: [limit_monthly_free, used_this_month]
                properties:
                  limit_monthly_free:
                    type: integer
                    example: 5
                  used_this_month:
                    type: integer
                    example: 3
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/payments/create:
    post:
      summary: Create SBP payment
      description: Initiate a new SBP transaction and return a URL for payment processing.
      operationId: createPayment
      tags: [payments]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentCreateRequest'
      responses:
        '200':
          description: Payment link
          content:
            application/json:
              schema:
                type: object
                required: [payment_id, url]
                properties:
                  payment_id:
                    type: string
                    example: 123e4567e89
                  url:
                    type: string
                    example: https://sbp.example/pay
                  autopay_binding_id:
                    type: string
                    nullable: true
                    description: Identifier of SBP Autopay binding
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/payments/{payment_id}:
    get:
      summary: Payment status
      description: Check the current status of a previously created SBP payment.
      operationId: getPaymentStatus
      tags: [payments]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
        - in: path
          name: payment_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Payment status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatusResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not found

  /v1/payments/sbp/webhook:
    post:
      summary: SBP payment webhook
      operationId: handleSbpWebhook
      description: Process SBP payment callback and update payment status.
      tags: [payments]
      security:
        - HmacAuth: []
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentWebhook'
      responses:
        '200':
          description: Accepted
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/payments/sbp/autopay/webhook:
    post:
      summary: SBP autopay webhook
      operationId: handleAutopayWebhook
      description: Process SBP Autopay callback and update payment status.
      tags: [payments]
      security:
        - HmacAuth: []
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutopayWebhook'
      responses:
        '200':
          description: Accepted
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/payments/sbp/autopay/cancel:
    post:
      summary: Cancel SBP autopay
      operationId: cancelAutopay
      description: Disable SBP Autopay for the user.
      tags: [payments]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutopayCancelRequest'
      responses:
        '204':
          description: Autopay canceled
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/partner/orders:
    post:
      summary: Order deep-link callback (AgroStore)
      operationId: partnerOrderCallback
      description: Receive deep-link order info from partner AgroStore.
      tags: [partner]
      security:
        - HmacAuth: []
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [order_id, user_tg_id, protocol_id, price_kopeks, signature]
              properties:
                order_id:
                  type: string
                user_tg_id:
                  type: integer
                protocol_id:
                  type: integer
                price_kopeks:
                  type: integer
                signature:
                  type: string
                  description: HMAC-SHA256 по телу запроса
      responses:
        '202':
          description: Queued
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/ask_expert:
    post:
      summary: Queue question for expert
      operationId: askExpert
      description: Send a question to a human agronomist for review.
      tags: [expert]
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ApiVersionHeader'
        - $ref: '#/components/parameters/UserIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [question]
              properties:
                question:
                  type: string
      responses:
        '202':
          description: Queued
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

tags:
  - name: diagnose
    description: Disease recognition
  - name: photos
    description: Photo history
  - name: payments
    description: SBP integration
  - name: limits
    description: User usage limits
  - name: partner
    description: External partner callbacks
  - name: expert
    description: Human expert questions
